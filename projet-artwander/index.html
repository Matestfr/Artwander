<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#FDFBF7">
    <meta name="color-scheme" content="light">
    <title>ArtWander Paris</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@400;600;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                        mono: ['monospace'],
                    },
                    colors: {
                        wander: {
                            base: '#FDFBF7',
                            dark: '#001B55',
                            gold: '#FFC857',
                            light: '#EBE5D9',
                            blue: '#2563EB',
                        }
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 27, 85, 0.08)',
                        'nav': '0 -4px 20px rgba(0,0,0,0.03)',
                        'card': '0 10px 30px -5px rgba(0, 27, 85, 0.1)',
                    }
                }
            }
        }
    </script>

    <style>
        :root { color-scheme: light; }
        body { background-color: #FDFBF7 !important; color: #001B55 !important; overflow-x: hidden; width: 100%; max-width: 100vw; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .swiper-pagination-bullet-active { background-color: #001B55 !important; }
        .header-scrolled { background: rgba(253, 251, 247, 0.95); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .header-transparent { background: transparent; border-bottom: 1px solid transparent; }
        .ticket-notch { position: absolute; width: 20px; height: 20px; background-color: #FDFBF7; border-radius: 50%; z-index: 10; }
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin-slow 12s linear infinite; }
        .fade-enter-active, .fade-leave-active { transition: all 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; transform: translateX(20px); }
        [x-cloak] { display: none !important; }
        .selected-card { border-color: #2563EB !important; background-color: #EFF6FF !important; }
        .stroke-text { -webkit-text-stroke: 1px #FFC857; color: transparent; font-weight: 900; line-height: 1; }
    </style>
</head>
<body class="antialiased selection:bg-wander-gold selection:text-wander-dark pb-28 w-full max-w-[100vw] overflow-x-hidden" 
      x-data="app()" 
      x-init="initTimers()"
      @scroll.window="scrolled = (window.pageYOffset > 10)">

    <header x-show="tab !== 'account'" 
            class="fixed top-0 left-0 right-0 z-50 h-16 flex items-center justify-between px-5 transition-all duration-300 w-full max-w-[100vw]"
            :class="scrolled ? 'header-scrolled' : 'header-transparent'">
        <div class="text-wander-dark font-serif font-black text-xl tracking-widest uppercase truncate">ArtWander</div>
        <div class="flex items-center gap-3">
            <div class="relative" x-data="{ open: false }">
                <button @click="open = !open" class="bg-white/80 border border-wander-dark/10 backdrop-blur text-wander-dark hover:bg-white transition-colors text-xs pl-3 pr-2 py-1.5 rounded-full font-bold flex items-center gap-1 active:scale-95 duration-200 font-sans shadow-sm">
                    <span x-text="currentCity">Paris</span>
                    <svg :class="open ? 'rotate-180' : ''" class="w-3 h-3 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div x-show="open" @click.outside="open = false" x-transition class="absolute top-full right-0 mt-2 w-32 bg-white rounded-xl shadow-xl border border-wander-light overflow-hidden py-1 z-[999] max-h-64 overflow-y-auto">
                    <template x-for="city in cities" :key="city">
                        <button @click="currentCity = city; open = false" class="w-full text-right px-4 py-2 text-xs font-medium text-wander-dark hover:bg-wander-base transition-colors font-sans" x-text="city"></button>
                    </template>
                </div>
            </div>
            <div @click="tab = 'account'" class="h-9 w-9 rounded-full bg-wander-dark border-2 border-white shadow-sm flex items-center justify-center cursor-pointer overflow-hidden ml-2">
                <img src="https://images.unsplash.com/photo-1516257178613-5b062d4e05f6?auto=format&fit=crop&w=150&q=80" class="h-full w-full object-cover opacity-90">
            </div>
        </div>
    </header>

    <main class="min-h-screen w-full max-w-full overflow-x-hidden">

        <div x-show="tab === 'home'" x-transition.opacity.duration.300ms class="pt-20 pb-8 w-full">
             <div class="px-4 mb-16 relative w-full overflow-hidden">
                <div class="absolute -right-12 -top-10 text-wander-gold opacity-20 animate-spin-slow pointer-events-none" style="z-index: 0; font-size: 12rem;">‚òÄ</div>
                <div class="relative w-full h-72 rounded-[2.5rem] rounded-bl-3xl rounded-br-3xl overflow-hidden shadow-soft group z-10">
                    <img :src="cityImages[currentCity]" class="w-full h-full object-cover object-center transition-transform duration-700 group-hover:scale-105 transition-opacity duration-300">
                    <div class="absolute inset-0 bg-gradient-to-t from-wander-dark/90 via-transparent to-transparent flex flex-col justify-end p-6">
                        <span class="text-wander-gold text-xs font-bold uppercase tracking-widest mb-1 font-sans">Bienvenue √† <span x-text="currentCity"></span></span>
                        <h1 class="text-white text-3xl font-serif font-medium leading-tight">√âveillez votre curiosit√©.</h1>
                        <p class="text-white/80 text-xs mt-1 font-light font-sans">Le meilleur de la Culture & du DIY.</p>
                    </div>
                </div>
            </div>

            <div class="mb-16 w-full overflow-hidden">
                <div class="swiper categories-swiper px-4 !pl-4">
                    <div class="swiper-wrapper">
                        <template x-for="cat in categories" :key="cat.name">
                            <div class="swiper-slide !w-28">
                                <button class="relative w-full aspect-[4/5] rounded-xl overflow-hidden shadow-md group active:scale-95 transition-transform border border-white/50">
                                    <img :src="cat.image" class="absolute inset-0 w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 grayscale-[20%] group-hover:grayscale-0">
                                    <div class="absolute inset-0 bg-wander-dark/20 group-hover:bg-transparent transition-colors flex items-end justify-center pb-3">
                                        <span class="text-white font-serif font-bold text-sm text-center px-1 shadow-text leading-tight bg-wander-dark/40 w-full py-1 backdrop-blur-sm" x-text="cat.name"></span>
                                    </div>
                                </button>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <div class="px-4 mb-20 w-full">
                <div class="bg-wander-dark rounded-2xl p-6 shadow-card text-white relative overflow-hidden">
                    <div class="absolute -left-6 -bottom-6 text-wander-gold opacity-10 text-9xl animate-spin-slow">‚òÄ</div>
                    <h2 class="text-sm font-bold text-wander-gold uppercase tracking-widest mb-2 font-serif">La R√®gle d'Or 2+2</h2>
                    <p class="text-xs text-white/80 mb-6 leading-relaxed font-light font-sans">Chaque mois, recevez <span class="font-bold text-white">2 exp√©riences sur-mesure</span> (vos go√ªts) et <span class="font-bold text-wander-gold">2 surprises totales</span> pour sortir de votre zone de confort.</p>
                    <div class="grid grid-cols-2 gap-4 relative z-10">
                        <div class="bg-white/5 p-4 rounded-xl text-center border border-white/10 backdrop-blur-sm">
                            <div class="text-2xl mb-1 text-wander-gold">üõãÔ∏è</div>
                            <div class="font-serif text-sm text-wander-gold">2 Confort</div>
                        </div>
                        <div class="bg-white/5 p-4 rounded-xl text-center border border-white/10 backdrop-blur-sm">
                            <div class="text-2xl mb-1 text-wander-gold">üöÄ</div>
                            <div class="font-serif text-sm text-wander-gold">2 D√©couverte</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-20 w-full overflow-hidden">
                <div class="flex justify-between items-end px-4 mb-6">
                    <h2 class="text-2xl font-serif font-bold text-wander-dark tracking-tight">Nos √©ditions limit√©es</h2>
                    <a href="#" class="text-wander-dark text-xs font-bold underline decoration-wander-gold decoration-2 font-sans">Tout voir</a>
                </div>
                <div class="swiper seasonal-swiper px-4 !pl-4">
                    <div class="swiper-wrapper pb-4">
                        <template x-for="box in oneShotBoxes" :key="box.id">
                            <div class="swiper-slide !w-64">
                                <div class="bg-white rounded-2xl overflow-hidden shadow-soft h-full border border-wander-light flex flex-col relative group transform transition-all hover:shadow-lg">
                                    <div class="h-44 relative overflow-hidden">
                                        <img :src="box.image" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                                        
                                        <div x-show="box.timerDisplay" class="absolute top-3 left-3 z-30 bg-black/70 backdrop-blur-md text-white text-[11px] font-bold px-3 py-1.5 rounded-full flex items-center gap-1.5 shadow-sm border border-white/10">
                                            <span class="text-wander-gold text-xs animate-pulse">‚òÄ</span> 
                                            <span x-text="box.timerDisplay" class="font-mono tracking-tight"></span>
                                        </div>

                                        <button @click.stop="toggleLike(box)" class="absolute top-3 right-3 z-30 p-2 rounded-full bg-white/90 shadow-sm active:scale-90 transition-transform">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-colors duration-300" :class="box.liked ? 'text-red-500 fill-red-500' : 'text-wander-dark'" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                                        </button>
                                    </div>
                                    <div class="p-5 flex-1 flex flex-col">
                                        <h3 class="font-serif font-bold text-wander-dark text-lg leading-tight mb-1" x-text="box.title"></h3>
                                        <p class="text-slate-500 text-xs leading-relaxed mb-4 line-clamp-2 font-sans" x-text="box.subtitle"></p>
                                        <div class="mt-auto flex items-end justify-between pt-4 border-t border-dashed border-wander-light">
                                            <div class="text-wander-dark font-serif font-bold text-lg" x-text="box.price"></div>
                                            <div class="flex items-center gap-1 bg-wander-base px-2 py-1 rounded-md border border-wander-light">
                                                <span class="text-wander-gold text-xs">‚òÖ</span>
                                                <span class="text-wander-dark text-xs font-bold font-sans" x-text="box.rating"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
            
            <div class="mb-12 w-full overflow-hidden">
                <h2 class="text-2xl font-serif font-bold text-wander-dark px-4 mb-6 tracking-tight">TOP 10 du moment</h2>
                <div class="swiper top10-swiper px-4 !pl-4">
                    <div class="swiper-wrapper">
                        <template x-for="(item, index) in top10" :key="item.id">
                            <div class="swiper-slide !w-40">
                                <div class="relative rounded-t-full rounded-b-[2rem] overflow-hidden h-64 shadow-md group border-2 border-white">
                                    <img :src="item.image" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                                    <div class="absolute inset-0 bg-gradient-to-t from-wander-dark via-transparent to-transparent opacity-90"></div>
                                    <div class="absolute bottom-0 -left-1 text-8xl stroke-text z-10 font-sans" x-text="index + 1"></div>
                                    <button @click.stop="toggleLike(item)" class="absolute top-3 right-3 z-30 p-2 rounded-full bg-wander-dark/30 backdrop-blur-md active:scale-90 transition-transform">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-colors duration-300" :class="item.liked ? 'text-red-500 fill-red-500' : 'text-white'" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                                    </button>
                                    <div class="absolute bottom-5 left-8 right-3 z-20 text-right">
                                        <div class="text-white font-serif text-sm leading-tight" x-text="item.title"></div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>

        <div x-show="tab === 'explore'" style="display: none;" class="pt-20 pb-32 w-full">
            <div class="bg-wander-base sticky top-16 z-30 px-4 pt-2 pb-2 shadow-soft w-full">
                <div class="relative mb-3">
                    <input type="text" placeholder="Rechercher une activit√©..." class="w-full bg-white text-wander-dark border border-wander-light rounded-xl py-3.5 pl-11 pr-4 text-sm font-medium focus:ring-2 focus:ring-wander-dark focus:border-wander-dark outline-none placeholder:text-slate-400 font-sans">
                    <span class="absolute left-4 top-3.5 text-slate-400"><svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg></span>
                </div>
                
                <div class="flex gap-2 overflow-x-auto no-scrollbar pb-2">
                    <button class="flex items-center gap-1.5 px-3 py-2 bg-white border border-wander-light rounded-lg text-xs font-bold text-wander-dark shadow-sm active:scale-95 transition-transform font-sans flex-shrink-0">
                        <svg class="w-4 h-4 text-wander-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>Dates
                    </button>
                    <button class="flex items-center gap-1.5 px-3 py-2 bg-white border border-wander-light rounded-lg text-xs font-bold text-wander-dark shadow-sm active:scale-95 transition-transform font-sans flex-shrink-0">
                        <svg class="w-4 h-4 text-wander-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/></svg>Cat√©gories
                    </button>
                    <button class="flex items-center gap-1.5 px-3 py-2 bg-white border border-wander-light rounded-lg text-xs font-bold text-wander-dark shadow-sm active:scale-95 transition-transform font-sans flex-shrink-0">
                        <svg class="w-4 h-4 text-wander-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>Prix
                    </button>
                </div>
            </div>
            
            <div class="px-4 mt-6">
                <div class="mb-8">
                    <h3 class="text-sm font-bold text-wander-dark mb-3 px-1 font-serif">Recherches populaires</h3>
                    <div class="flex flex-wrap gap-2">
                        <template x-for="tag in popularSearches" :key="tag">
                            <button class="px-4 py-1.5 rounded-full border border-wander-dark text-wander-dark text-xs font-bold bg-white hover:bg-wander-dark hover:text-white transition-colors duration-200 active:scale-95 font-sans"><span x-text="tag"></span></button>
                        </template>
                    </div>
                </div>
                <div class="mb-8">
                    <h3 class="text-sm font-bold text-wander-dark mb-4 px-1 font-serif">Parcourir par univers</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <template x-for="cat in exploreCategories" :key="cat.name">
                            <button class="flex items-center gap-3 p-3 bg-white border border-wander-light rounded-xl hover:border-wander-dark transition-colors active:scale-95 group text-left">
                                <div class="w-12 h-12 rounded-lg overflow-hidden shrink-0 shadow-sm"><img :src="cat.image" class="w-full h-full object-cover"></div>
                                <span class="font-bold text-wander-dark text-xs leading-tight font-serif" x-text="cat.name"></span>
                            </button>
                        </template>
                    </div>
                </div>
                <div class="mb-6">
                    <h3 class="text-sm font-bold text-wander-dark mb-3 px-1 font-serif">Les Box Partenaires</h3>
                    <div class="space-y-3">
                        <template x-for="box in partnerBoxes" :key="box.id">
                            <div class="relative flex gap-3 bg-white p-3 rounded-xl shadow-sm border border-wander-light">
                                <img :src="box.image" class="w-20 h-20 rounded-lg object-cover bg-wander-base">
                                <div class="flex-1 flex flex-col justify-center">
                                    <span class="text-[10px] text-slate-400 uppercase tracking-wide font-medium font-sans" x-text="box.partner"></span>
                                    <h4 class="font-bold text-wander-dark text-sm mt-0.5 font-serif" x-text="box.title"></h4>
                                    <div class="flex items-center gap-2 mt-2">
                                        <span class="text-[10px] bg-wander-base text-wander-dark px-1.5 py-0.5 rounded font-medium font-sans" x-text="box.type"></span>
                                        <span class="text-[10px] text-wander-gold font-bold font-sans">‚òÖ 4.9</span>
                                    </div>
                                </div>
                                <button @click.stop="toggleLike(box)" class="absolute top-2 right-2 p-1.5 rounded-full bg-white/90 shadow-sm active:scale-90 transition-transform z-10 border border-wander-light">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transition-colors duration-300" :class="box.liked ? 'text-red-500 fill-red-500' : 'text-slate-300'" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
                                </button>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>

        <div x-show="tab === 'favorites'" style="display: none;" class="pt-20 pb-32 px-4 w-full">
            <div class="px-5 mb-6">
                <h1 class="text-2xl font-serif font-bold text-wander-dark mb-4">Favoris</h1>
                <div class="flex gap-2 font-sans">
                    <button @click="favFilter = 'all'" :class="favFilter === 'all' ? 'bg-wander-dark text-white border-wander-dark' : 'bg-white text-slate-500 border-wander-light'" class="px-4 py-1.5 rounded-full text-xs font-bold border transition-colors">Tout</button>
                    <button @click="favFilter = 'active'" :class="favFilter === 'active' ? 'bg-wander-dark text-white border-wander-dark' : 'bg-white text-slate-500 border-wander-light'" class="px-4 py-1.5 rounded-full text-xs font-bold border transition-colors">Actives</button>
                    <button @click="favFilter = 'inactive'" :class="favFilter === 'inactive' ? 'bg-wander-dark text-white border-wander-dark' : 'bg-white text-slate-500 border-wander-light'" class="px-4 py-1.5 rounded-full text-xs font-bold border transition-colors">Pass√©es</button>
                </div>
            </div>
            <div class="px-5 space-y-4">
                
                <div x-show="favFilter !== 'inactive' && getFavorites().length === 0" class="flex flex-col items-center justify-center py-20 text-center font-sans">
                    <div class="w-16 h-16 bg-wander-light rounded-full flex items-center justify-center mb-4 text-3xl opacity-50">üíî</div>
                    <p class="text-wander-dark font-bold">Aucun coup de c≈ìur</p>
                    <p class="text-slate-400 text-sm mt-1">Explorez pour ajouter des favoris.</p>
                </div>

                <div x-show="favFilter === 'inactive'" class="flex gap-4 border-b border-wander-light pb-4 grayscale opacity-70">
                    <div class="relative w-24 h-24 shrink-0">
                        <img src="https://images.unsplash.com/photo-1544212415-b269f18bf7ed?w=900&auto=format&fit=crop&q=60" class="w-full h-full object-cover rounded-xl bg-slate-200">
                        <div class="absolute inset-0 bg-black/10 rounded-xl flex items-center justify-center"><span class="bg-black text-white text-[10px] font-bold px-2 py-0.5 rounded font-sans">Termin√©</span></div>
                    </div>
                    <div class="flex-1 flex flex-col justify-between py-0.5">
                        <div>
                            <div class="text-[10px] text-slate-500 font-medium uppercase font-sans">Box Hiver</div>
                            <h3 class="font-bold text-slate-600 text-sm leading-tight mt-0.5 font-serif">No√´l Boh√®me</h3>
                            <div class="text-xs text-slate-400 mt-1 font-sans">Expir√© le 25 D√©c.</div>
                        </div>
                    </div>
                </div>

                <div x-show="favFilter !== 'inactive'">
                    <template x-for="item in getFavorites()" :key="item.title + refreshKey">
                        <div class="flex gap-4 border-b border-wander-light pb-4" x-transition:leave="transition ease-in duration-300" x-transition:leave-end="opacity-0 translate-x-10">
                            <div class="relative w-24 h-24 shrink-0">
                                <img :src="item.image" class="w-full h-full object-cover rounded-xl border border-wander-light">
                                <button @click.prevent.stop="toggleLike(item)" class="absolute top-1.5 right-1.5 bg-white rounded-full p-1 shadow-sm active:scale-90 transition-transform z-50 pointer-events-auto">
                                    <svg class="w-3.5 h-3.5 text-red-500 fill-current" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /></svg>
                                </button>
                                <div x-show="item.timerDisplay" class="absolute bottom-0 left-0 right-0 bg-wander-dark/80 text-white text-[9px] text-center py-0.5 rounded-b-xl backdrop-blur-sm font-sans"><span x-text="item.timerDisplay"></span></div>
                            </div>
                            <div class="flex-1 flex flex-col justify-between py-0.5">
                                <div>
                                    <h3 class="font-serif font-bold text-wander-dark text-sm leading-tight mt-0.5 line-clamp-2" x-text="item.title"></h3>
                                    <div class="text-xs text-slate-500 mt-1 font-sans" x-text="item.subtitle || 'Box Partenaire'"></div>
                                </div>
                                <div class="flex items-end justify-between mt-2 font-sans">
                                    <div class="text-wander-dark font-bold text-sm" x-text="item.price || 'Inclus'"></div>
                                    <div class="flex items-center gap-1"><span class="text-wander-gold text-xs">‚òÖ</span><span class="text-wander-dark text-xs font-semibold" x-text="item.rating || '4.8'"></span></div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <div x-show="tab === 'create'" style="display: none;" class="pt-20 px-4 pb-32 w-full h-full">
            <h1 class="text-2xl font-serif font-bold text-wander-dark mb-6 text-center" x-show="step < 6">Cr√©er ma Box</h1>
             <div x-show="step===1" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-x-10">
                <h2 class="text-xl font-bold text-wander-dark mb-4 font-serif">Votre humeur du mois ?</h2>
                <div class="space-y-3 mt-6">
                    <button @click="setPath('cocooning'); nextStep()" class="w-full p-5 border border-wander-light bg-white rounded-2xl flex items-center gap-4 hover:border-wander-dark transition-all text-left shadow-sm">
                        <span class="text-3xl">‚òï</span><div><div class="font-bold text-wander-dark">Cocooning</div><div class="text-xs text-slate-500">Mus√©es, calme, assis...</div></div>
                    </button>
                    <button @click="setPath('adventure'); nextStep()" class="w-full p-5 border border-wander-light bg-white rounded-2xl flex items-center gap-4 hover:border-wander-dark transition-all text-left shadow-sm">
                        <span class="text-3xl">‚ö°</span><div><div class="font-bold text-wander-dark">Aventure</div><div class="text-xs text-slate-500">Insolite, action, marche...</div></div>
                    </button>
                    <button @click="setPath('random'); startGeneration()" class="w-full p-5 border-2 border-dashed border-wander-gold bg-wander-base rounded-2xl flex items-center gap-4 hover:bg-white transition-all text-left shadow-sm">
                        <span class="text-3xl animate-spin-slow">üé≤</span><div><div class="font-bold text-wander-dark">Surprenez-moi !</div><div class="text-xs text-slate-500">Al√©atoire total (Rapide)</div></div>
                    </button>
                </div>
             </div>
             
             <div x-show="step===2" style="display: none;" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-x-10">
                 <h2 class="text-xl font-bold text-wander-dark mb-4 font-serif">Avec qui sortez-vous ?</h2>
                 <div class="grid grid-cols-2 gap-4">
                    <button @click="config.company = 'solo'; nextStep()" class="p-6 bg-white border border-wander-light rounded-xl hover:border-wander-dark shadow-sm flex flex-col items-center justify-center transition-all"><span class="text-3xl mb-2">üßò</span><span class="font-bold text-sm text-wander-dark">Solo</span></button>
                    <button @click="config.company = 'duo'; nextStep()" class="p-6 bg-white border border-wander-light rounded-xl hover:border-wander-dark shadow-sm flex flex-col items-center justify-center transition-all"><span class="text-3xl mb-2">üíë</span><span class="font-bold text-sm text-wander-dark">Duo</span></button>
                    <button @click="config.company = 'tribu'; nextStep()" class="p-6 bg-white border border-wander-light rounded-xl hover:border-wander-dark shadow-sm flex flex-col items-center justify-center transition-all"><span class="text-3xl mb-2">üëØ</span><span class="font-bold text-sm text-wander-dark">Tribu</span></button>
                    <button @click="config.company = 'groupe'; nextStep()" class="p-6 bg-white border border-wander-light rounded-xl hover:border-wander-dark shadow-sm flex flex-col items-center justify-center transition-all"><span class="text-3xl mb-2">üé≤</span><span class="font-bold text-sm text-wander-dark">Groupe</span></button>
                 </div>
                 <button @click="step--" class="mt-8 text-xs text-slate-400 underline w-full text-center">Retour</button>
             </div>

             <div x-show="step===3" style="display: none;" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-x-10">
                 <h2 class="text-xl font-bold text-wander-dark mb-4 font-serif">Envie de cr√©er ?</h2>
                 <div class="space-y-4">
                    <button @click="config.type = 'manual'; nextStep()" class="w-full p-5 bg-white border border-wander-light rounded-xl flex items-center gap-4 hover:border-wander-dark shadow-sm transition-all">
                        <span class="text-3xl">üëê</span><div><div class="font-bold text-wander-dark text-left">Mains dans la terre</div><div class="text-xs text-slate-500 text-left">Poterie, Tufting, Peinture...</div></div>
                    </button>
                    <button @click="config.type = 'visual'; nextStep()" class="w-full p-5 bg-white border border-wander-light rounded-xl flex items-center gap-4 hover:border-wander-dark shadow-sm transition-all">
                        <span class="text-3xl">üëÄ</span><div><div class="font-bold text-wander-dark text-left">Plein les yeux</div><div class="text-xs text-slate-500 text-left">Expos, Th√©√¢tre, Spectacles...</div></div>
                    </button>
                 </div>
                 <button @click="step--" class="mt-8 text-xs text-slate-400 underline w-full text-center">Retour</button>
             </div>

             <div x-show="step===4" style="display: none;" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-x-10">
                 <h2 class="text-xl font-bold text-wander-dark mb-4 font-serif">Quand √™tes-vous dispo ?</h2>
                 <div class="space-y-4">
                    <button @click="nextStep()" class="w-full p-4 bg-white border border-wander-light rounded-xl font-bold text-wander-dark shadow-sm hover:border-wander-dark transition-all">En semaine (Soir√©e)</button>
                    <button @click="nextStep()" class="w-full p-4 bg-white border border-wander-light rounded-xl font-bold text-wander-dark shadow-sm hover:border-wander-dark transition-all">Le Weekend (Journ√©e)</button>
                    <button @click="nextStep()" class="w-full p-4 bg-white border border-wander-light rounded-xl font-bold text-wander-dark shadow-sm hover:border-wander-dark transition-all">Peu importe, surprenez-moi</button>
                 </div>
                 <button @click="step--" class="mt-8 text-xs text-slate-400 underline w-full text-center">Retour</button>
             </div>

             <div x-show="step===5" style="display: none;" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-x-10">
                 <h2 class="text-xl font-bold text-wander-dark mb-4 font-serif">Th√®mes favoris</h2>
                 <div class="flex flex-wrap gap-3 mb-8">
                     <template x-for="theme in ['Gastronomie', 'Histoire', 'Street Art', 'Musique', 'Nature', 'Tech', 'Mode']">
                         <button @click="toggleTheme(theme)" 
                                 class="px-4 py-2 rounded-full text-sm font-medium border transition-all"
                                 :class="config.themes.includes(theme) ? 'bg-wander-blue text-white border-wander-blue' : 'bg-white text-wander-dark border-wander-light hover:border-wander-dark'">
                             <span x-text="theme"></span>
                         </button>
                     </template>
                 </div>
                 <button @click="startGeneration()" class="w-full py-4 rounded-xl font-bold shadow-lg transition-all" :class="config.themes.length > 0 ? 'bg-wander-blue text-white active:scale-95' : 'bg-gray-200 text-gray-400 cursor-not-allowed'" :disabled="config.themes.length === 0">G√©n√©rer ma Box Sur-Mesure</button>
                 <button @click="step--" class="mt-6 text-xs text-slate-400 underline w-full text-center">Retour</button>
             </div>

             <div x-show="step===6" style="display: none;" class="flex-1 flex flex-col items-center justify-center text-center pt-20">
                <div class="text-6xl animate-spin-slow mb-4 text-wander-gold">‚òÄ</div>
                <h3 class="text-xl font-bold text-wander-dark font-serif">Composition en cours...</h3>
            </div>
            
            <div x-show="step===7" style="display: none;" class="flex-1 flex flex-col items-center justify-center text-center pt-10">
                 <div class="text-5xl mb-4">üéâ</div>
                 <h2 class="text-2xl font-serif font-bold text-wander-dark mb-2">C'est pr√™t !</h2>
                 <div class="bg-white p-6 rounded-2xl shadow-lg border border-wander-light w-full mb-6 relative">
                     <button @click="togglePreviewLike()" class="absolute top-4 right-4 text-2xl active:scale-90 transition-transform">
                        <span x-text="previewBoxLiked ? '‚ù§Ô∏è' : 'ü§ç'"></span>
                     </button>
                     <h3 class="font-serif font-bold text-xl text-wander-dark mb-1" x-text="previewBox.title"></h3>
                     <p class="text-xs text-slate-400 italic mb-4" x-text="previewBox.desc"></p>
                     <div class="space-y-2 text-left">
                         <template x-for="t in previewBox.tickets">
                             <div class="flex items-center gap-2 text-sm text-slate-600"><span x-text="t.icon"></span> <span x-text="t.title"></span></div>
                         </template>
                     </div>
                 </div>
                 <div class="flex flex-col gap-3 w-full">
                    <button @click="buyBox()" class="w-full bg-wander-dark text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition-transform font-sans">Acheter la Box (45‚Ç¨)</button>
                    <button @click="resetConfig()" class="w-full text-slate-400 text-xs py-2 hover:text-red-400">Supprimer et recommencer</button>
                 </div>
            </div>
        </div>

        <div x-show="tab === 'box'" style="display: none;" class="pt-20 px-4 pb-32 w-full">
            <div class="bg-wander-dark rounded-2xl p-6 shadow-lg mb-6 relative overflow-hidden text-white">
                <div class="absolute -right-10 -top-10 text-wander-gold opacity-10 text-9xl animate-spin-slow">‚òÄ</div>
                <h2 class="text-2xl font-serif font-bold mb-1">Janvier ‚Ä¢ Endless Summer</h2>
                <div class="flex items-center gap-2 mb-4 font-sans">
                    <span class="inline-block w-2 h-2 rounded-full bg-green-400 animate-pulse"></span>
                    <span class="text-xs font-medium opacity-80 uppercase tracking-wide">Box Active</span>
                </div>
                <div class="w-full bg-white/20 rounded-full h-1.5 mb-2"><div class="bg-wander-gold h-1.5 rounded-full w-1/4"></div></div>
                <p class="text-right text-[10px] opacity-70 font-sans">1/4 exp√©riences r√©alis√©es</p>
                <div class="mt-2 text-right text-[10px] opacity-70 font-sans">Valable jusqu'au: 31 D√©c.</div>
            </div>
            
            <div class="space-y-4 mb-8">
                <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wide font-sans">Vos Billets (Abonnement)</h3>
                <template x-for="ticket in myBoxTickets" :key="ticket.id">
                    <div class="relative bg-white rounded-2xl shadow-sm overflow-hidden border border-wander-light" :class="ticket.transferred ? 'grayscale opacity-75' : ''">
                        <div class="p-4 pb-6 flex gap-4 items-center">
                            <div class="w-16 h-16 rounded-xl bg-wander-base flex items-center justify-center shrink-0 text-2xl border border-wander-light">
                                <span x-text="ticket.type === 'confort' ? 'üõãÔ∏è' : 'üöÄ'"></span>
                            </div>
                            <div class="flex-1">
                                <span class="text-[10px] uppercase font-bold px-2 py-0.5 rounded-full mb-1 bg-wander-base text-wander-dark font-sans" x-text="ticket.type"></span>
                                <h4 class="font-serif font-bold text-wander-dark text-lg leading-tight mt-1" x-text="ticket.title"></h4>
                                <p class="text-xs text-slate-500 mt-1 font-sans" x-text="ticket.month + ' ' + ticket.day + ' ‚Ä¢ ' + ticket.location"></p>
                            </div>
                        </div>
                        <div class="relative h-px w-full">
                            <div class="absolute inset-0 border-t-2 border-dashed border-wander-light"></div>
                            <div class="ticket-notch -left-3 -top-2.5"></div> <div class="ticket-notch -right-3 -top-2.5"></div> 
                        </div>
                        <div class="bg-wander-base/50 p-4 flex justify-between items-center font-sans">
                            <div class="flex gap-3" x-show="!ticket.transferred">
                                <button @click="shiftTicket(ticket)" class="text-[10px] text-wander-blue font-bold hover:underline">D√©caler (+7j)</button>
                                <button @click="transferTicket(ticket)" class="text-[10px] text-wander-blue font-bold hover:underline">Transf√©rer</button>
                            </div>
                            <div x-show="ticket.transferred" class="text-xs font-bold text-slate-500 italic">Transf√©r√© √† un proche</div>
                            <button x-show="!ticket.transferred" @click="openQr(ticket)" class="text-wander-dark text-xs font-bold flex items-center gap-1 hover:underline">Voir la contremarque</button>
                        </div>
                    </div>
                </template>

                <template x-for="pBox in purchasedBoxes" :key="pBox.id">
                    <div class="mt-8">
                        <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wide font-sans mb-2">Box Suppl√©mentaire</h3>
                        <button @click="pBox.expanded = !pBox.expanded" class="w-full bg-wander-dark rounded-xl p-5 flex items-center justify-between shadow-md text-white group overflow-hidden relative active:scale-98 transition-transform">
                             <div class="absolute -right-5 -top-5 text-wander-gold opacity-10 text-6xl animate-spin-slow pointer-events-none">‚òÄ</div>
                             <div class="relative z-10 flex items-center gap-4">
                                <div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-xl">üéÅ</div>
                                <div class="text-left">
                                    <h3 class="font-serif font-bold text-base leading-tight" x-text="pBox.title"></h3>
                                    <div class="flex items-center gap-2 mt-1">
                                        <span class="w-2 h-2 rounded-full bg-slate-400"></span>
                                        <span class="text-[10px] font-bold opacity-70 uppercase tracking-wide">Box Inactive</span>
                                    </div>
                                </div>
                            </div>
                            <span class="transform transition-transform duration-300 text-xl text-wander-gold relative z-10" :class="pBox.expanded ? 'rotate-180' : ''">‚ñº</span>
                        </button>

                        <div x-show="pBox.expanded" x-collapse class="mt-4 space-y-4 pl-2 ml-2 border-l-2 border-wander-light/50">
                            <template x-for="ticket in pBox.tickets">
                                <div class="relative bg-white rounded-2xl shadow-sm overflow-hidden border border-wander-light border-l-4 border-l-wander-gold">
                                    <div class="p-4 pb-6 flex gap-4 items-center">
                                        <div class="w-14 h-14 rounded-xl bg-wander-base flex items-center justify-center shrink-0 text-xl border border-wander-light">
                                            <span x-text="ticket.icon"></span>
                                        </div>
                                        <div class="flex-1">
                                            <span class="text-[9px] uppercase font-bold px-2 py-0.5 rounded-full mb-1 bg-wander-gold text-wander-dark font-sans">Achet√©</span>
                                            <h4 class="font-serif font-bold text-wander-dark text-base leading-tight mt-1" x-text="ticket.title"></h4>
                                            <p class="text-xs text-slate-500 mt-1 font-sans" x-text="ticket.loc"></p>
                                        </div>
                                    </div>
                                    <div class="bg-wander-base/50 p-3 flex justify-between items-center font-sans border-t border-dashed border-wander-light">
                                        <div class="text-[9px] text-slate-400" x-text="ticket.peopleText + ' ‚Ä¢ Valable jusqu\'au ' + pBox.validUntil"></div>
                                        <button @click="openQr(ticket)" class="text-wander-dark text-[10px] font-bold flex items-center gap-1 hover:underline">
                                            Voir la contremarque
                                        </button>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <div x-show="tab === 'subscription'" style="display: none;" class="pt-20 px-4 pb-32">
             <h1 class="text-2xl font-serif font-bold text-wander-dark mb-2">Abonnement</h1>
             <div class="relative pl-4 border-l-2 border-wander-light space-y-8 ml-2 mt-8">
                <template x-for="month in subscriptionTimeline" :key="month.name">
                    <div class="relative pl-6" :class="month.status === 'locked' ? 'opacity-60 grayscale' : (month.status === 'past' ? 'opacity-75' : '')">
                        <div class="absolute -left-[25px] top-1 w-4 h-4 rounded-full border-2 border-white flex items-center justify-center"
                             :class="month.status === 'active' ? 'bg-wander-dark ring-4 ring-wander-light scale-125' : (month.status === 'past' ? 'bg-slate-400' : 'bg-slate-300')">
                             <span x-show="month.status === 'past'" class="text-[8px] text-white">‚úì</span>
                        </div>
                        <h4 class="text-sm font-bold font-serif" :class="month.status === 'active' ? 'text-wander-dark' : 'text-slate-500'" x-text="month.name"></h4>
                        <div class="bg-white p-4 rounded-xl mt-2 border relative overflow-hidden" 
                             :class="month.status === 'active' ? 'shadow-md border-wander-dark' : 'border-slate-100 border-dashed'">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="text-[10px] uppercase font-bold mb-1 font-sans" :class="month.status === 'active' ? 'text-wander-dark' : 'text-slate-400'" x-text="'Th√®me : ' + month.theme"></div>
                                    <div class="text-sm font-medium text-slate-700 font-sans" x-text="month.desc"></div>
                                </div>
                                <span class="text-2xl" x-text="month.status === 'locked' ? 'üîí' : month.icon"></span>
                            </div>
                            <button x-show="month.status === 'active'" @click="tab = 'box'" class="mt-3 w-full py-2 bg-wander-dark text-white rounded-lg text-xs font-bold shadow-md active:scale-95 transition-transform font-sans">Voir mes tickets</button>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <div x-show="tab === 'account'" style="display: none;" class="pt-20 px-4 w-full">
            <div class="bg-wander-dark rounded-3xl p-6 shadow-card text-center mb-6 relative overflow-hidden text-white">
                <div class="absolute -right-12 -top-10 text-wander-gold opacity-10 text-9xl animate-spin-slow pointer-events-none" style="font-size: 10rem;">‚òÄ</div>
                <div class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-wander-gold shadow-md overflow-hidden relative z-10">
                     <img src="https://images.unsplash.com/photo-1516257178613-5b062d4e05f6?auto=format&fit=crop&w=150&q=80" class="h-full w-full object-cover">
                </div>
                <h2 class="text-xl font-serif font-bold text-white relative z-10">Sarah Miller</h2>
                <p class="text-sm text-white/70 font-sans relative z-10">s.miller@email.com</p>
            </div>
            
            <div class="px-5 py-6 space-y-3 font-sans">
                <button class="w-full bg-white p-4 rounded-xl flex items-center gap-4 shadow-sm border border-wander-light group active:scale-95 transition-transform">
                    <div class="bg-wander-base p-3 rounded-xl text-wander-dark"><svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" /></svg></div>
                    <div class="text-left"><div class="font-bold text-wander-dark font-serif">Parrainage</div><div class="text-xs text-slate-400">Invitez des amis, gagnez des box</div></div>
                </button>
                <button class="w-full bg-white p-4 rounded-xl flex items-center gap-4 shadow-sm border border-wander-light group active:scale-95 transition-transform">
                    <div class="bg-wander-base p-3 rounded-xl text-wander-dark"><svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" /></svg></div>
                    <div class="text-left"><div class="font-bold text-wander-dark font-serif">Codes Promo</div><div class="text-xs text-slate-400">Ajouter un code de r√©duction</div></div>
                </button>
                <button class="w-full bg-white p-4 rounded-xl flex items-center gap-4 shadow-sm border border-wander-light group active:scale-95 transition-transform">
                    <div class="bg-wander-base p-3 rounded-xl text-wander-dark"><svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg></div>
                    <div class="text-left"><div class="font-bold text-wander-dark font-serif">Club Culture</div><div class="text-xs text-slate-400">Niveau : Passionn√©e (450 pts)</div></div>
                </button>
            </div>
            
            <div class="px-5 pb-32 font-sans">
                <div class="space-y-2">
                    <button class="w-full bg-white p-4 rounded-xl shadow-sm flex items-center justify-between group active:scale-95 transition-transform border border-wander-light">
                        <div class="flex items-center gap-3"><span class="text-xl">üí≥</span><span class="text-sm font-bold text-wander-dark">G√©rer l'abonnement</span></div><span class="text-slate-300">‚Üí</span>
                    </button>
                    <button class="w-full bg-white p-4 rounded-xl shadow-sm flex items-center justify-between group active:scale-95 transition-transform border border-wander-light">
                        <div class="flex items-center gap-3"><span class="text-xl">üìç</span><span class="text-sm font-bold text-wander-dark">Ma Ville</span></div>
                        <div class="flex items-center gap-2"><span class="text-xs text-slate-400" x-text="currentCity"></span><span class="text-slate-300">‚Üí</span></div>
                    </button>
                    <button class="w-full bg-white p-4 rounded-xl shadow-sm flex items-center justify-between group active:scale-95 transition-transform border border-wander-light">
                        <div class="flex items-center gap-3"><span class="text-xl">‚ùì</span><span class="text-sm font-bold text-wander-dark">Aide & Support</span></div><span class="text-slate-300">‚Üí</span>
                    </button>
                </div>
                <div class="mt-8 text-center"><button class="text-xs text-red-500 font-bold opacity-60 hover:opacity-100">Se d√©connecter</button><div class="text-[9px] text-slate-300 mt-2">v46.0.0 ArtWander</div></div>
            </div>
        </div>

    </main>

    <nav class="fixed bottom-0 inset-x-0 bg-wander-base border-t border-wander-light pb-safe pt-1.5 h-[84px] z-50 shadow-nav w-full overflow-x-auto no-scrollbar">
        <div class="grid grid-cols-7 h-full items-start px-1 w-full min-w-[350px]">
            <template x-for="item in navItems">
                <button @click="tab = item.id" class="flex flex-col items-center justify-center gap-1 group pt-1">
                    <div :class="tab === item.id ? 'text-wander-dark scale-110' : 'text-slate-400'" class="transition-all duration-200" x-html="item.icon"></div>
                    <span class="text-[8px] font-medium font-sans truncate w-full text-center" :class="tab === item.id ? 'text-wander-dark font-bold' : 'text-slate-400'" x-text="item.label"></span>
                </button>
            </template>
        </div>
    </nav>

    <div x-show="qrOpen" class="fixed inset-0 z-[70] bg-black/95 backdrop-blur-sm flex items-center justify-center p-5 font-sans" x-transition.opacity style="display: none;">
         <div class="bg-white rounded-3xl p-8 w-full max-w-sm text-center relative shadow-2xl overflow-hidden" @click.outside="closeQr()">
            <button @click="closeQr()" class="absolute top-4 right-4 text-slate-400 z-10 bg-white/80 rounded-full p-1">‚úï</button>
            <h3 class="text-xl font-bold text-slate-800 font-serif mb-2">Votre Contremarque</h3>
            <p class="text-sm text-slate-500 mb-6" x-text="activeTicket?.title"></p>
            
            <template x-if="activeTicket?.imageSrc">
                 <div class="relative w-full aspect-[2/3] rounded-xl overflow-hidden shadow-lg border border-wander-light mb-4">
                     <img :src="activeTicket.imageSrc" class="w-full h-full object-cover">
                     <div class="absolute bottom-0 inset-x-0 bg-black/60 text-white text-[10px] p-2 text-center">
                         Ceci est une simulation. En prod, l'image r√©elle s'affiche ici.
                     </div>
                 </div>
            </template>
            <template x-if="!activeTicket?.imageSrc">
                 <img :src="currentQrUrl" class="w-48 h-48 object-contain mx-auto my-6 border-2 border-wander-light p-2 rounded-xl">
            </template>

            <div class="text-xs text-wander-dark font-bold bg-wander-base py-2 rounded-full">Pr√©sentez ce visuel √† l'entr√©e</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('app', () => ({
                tab: 'home',
                qrOpen: false, currentQrUrl: '', activeTicket: null, step: 1, favFilter: 'all', scrolled: false, currentCity: 'Paris',
                refreshKey: 0, 
                
                selectedPath: 'cocooning',
                previewBox: {}, 
                previewBoxLiked: false,
                transfersLeft: 3, 

                // --- DATA ---
                
                // 1. BOX ST VALENTIN (Vos images locales)
                purchasedBoxes: [
                    {
                        id: 'static-valentin',
                        title: "The Saint Valentin Box",
                        subtitle: "L'amour √† l'≈ìuvre",
                        status: 'inactive',
                        validUntil: '14 F√©v 2026',
                        expanded: false,
                        tickets: [
                            { title: "Cyrano de Bergerac", loc: "Com√©die Fran√ßaise", icon: "üé≠", peopleText: "Billet Duo", type: "culture", imageSrc: "./images/Saint.Valentin1.png" },
                            { title: "La Traviata de Verdi", loc: "Op√©ra National", icon: "üéª", peopleText: "Billet Duo", type: "musique", imageSrc: "./images/Saint.Valentin2.png" },
                            { title: "In The Mood For Love", loc: "Cin√©ma MK2", icon: "üé¨", peopleText: "Billet Duo", type: "cinema", imageSrc: "./images/Saint.Valentin3.png" },
                            { title: "Po√®mes de Pablo Neruda", loc: "Retrait Fnac", icon: "üìñ", peopleText: "Livre inclus", type: "litterature", imageSrc: "./images/Saint.Valentin4.png" }
                        ]
                    }
                ],

                // 2. TICKETS ABONNEMENT (Endless Summer - Vos images locales)
                myBoxTickets: [
                      { id: 1, title: 'Caf√© C√©ramique', loc: 'Papotterie (11e)', month: 'JAN', day: '12', type: 'confort', transferred: false, imageSrc: "./images/Endless.summer.1.png" },
                      { id: 2, title: 'Deep Dimanche', loc: 'Open Air', month: 'JAN', day: '18', type: 'decouverte', transferred: false, imageSrc: "./images/Endless.summer.4.png" },
                      { id: 3, title: 'La Piscine (Film)', loc: 'Projection Etoiles', month: 'JAN', day: '24', type: 'confort', transferred: false, imageSrc: "./images/Endless.summer.2.png" },
                      { id: 4, title: 'Bonjour Tristesse', loc: 'Retrait Fnac', month: 'JAN', day: '29', type: 'culture', transferred: false, imageSrc: "./images/Endless.summer.3.png" }
                ],

                // 40+ ACTIVITES (BDD √âTENDUE)
                allActivities: [
                    { title: "Atelier C√©ramique", loc: "Marais", icon: "üé®", type: 'comfort', mood: 'cocooning' },
                    { title: "Expo Monet", loc: "Orangerie", icon: "üñºÔ∏è", type: 'comfort', mood: 'cocooning' },
                    { title: "Atelier Bougie", loc: "Marais", icon: "üïØÔ∏è", type: 'comfort', mood: 'cocooning'},
                    { title: "D√©gustation Th√©", loc: "Mariage F.", icon: "üçµ", type: 'comfort', mood: 'cocooning'},
                    { title: "Cin√©ma Art & Essai", loc: "Quartier Latin", icon: "üé¨", type: 'comfort', mood: 'cocooning' },
                    { title: "Peinture sur Soie", loc: "Montmartre", icon: "üß£", type: 'comfort', mood: 'cocooning' },
                    { title: "Lecture & Vin", loc: "Librairie", icon: "üç∑", type: 'comfort', mood: 'cocooning' },
                    { title: "Yoga & Brunch", loc: "Canal St Martin", icon: "üßò", type: 'comfort', mood: 'cocooning' },
                    { title: "Meditation Sonore", loc: "Marais", icon: "üîî", type: 'comfort', mood: 'cocooning' },
                    { title: "Atelier Ikebana", loc: "Jardin Plantes", icon: "üå∫", type: 'comfort', mood: 'cocooning' },
                    { title: "Croisi√®re Seine", loc: "Pont Neuf", icon: "üö¢", type: 'comfort', mood: 'cocooning' },
                    
                    { title: "Visite Insolite", loc: "Montmartre", icon: "‚õ™", type: 'discovery', mood: 'cocooning' },
                    { title: "Concert Jazz Cach√©", loc: "Caveau", icon: "üé∑", type: 'discovery', mood: 'cocooning' },
                    { title: "Atelier Parfum", loc: "Grasse (Paris)", icon: "üëÉ", type: 'discovery', mood: 'cocooning' },
                    { title: "Plan√©tarium Priv√©", loc: "Palais", icon: "üåå", type: 'discovery', mood: 'cocooning' },
                    { title: "D√Æner dans le Noir", loc: "Beaubourg", icon: "üåë", type: 'discovery', mood: 'cocooning' },

                    { title: "Balade V√©lo", loc: "Bords de Marne", icon: "üö≤", type: 'comfort', mood: 'adventure' },
                    { title: "Rando Urbaine", loc: "Petite Ceinture", icon: "üö∂", type: 'comfort', mood: 'adventure' },
                    { title: "Cours Photo Street", loc: "Belleville", icon: "üì∑", type: 'comfort', mood: 'adventure' },
                    { title: "Cuisine du Monde", loc: "Sentier", icon: "üç≤", type: 'comfort', mood: 'adventure' },
                    { title: "Karting Electrique", loc: "La Villette", icon: "üèéÔ∏è", type: 'comfort', mood: 'adventure' },
                    
                    { title: "Catacombes", loc: "Denfert", icon: "üíÄ", type: 'discovery', mood: 'adventure' },
                    { title: "Street Art Tour", loc: "13e Arr.", icon: "üß±", type: 'discovery', mood: 'adventure' },
                    { title: "Escape Game Horreur", loc: "Bastille", icon: "üîí", type: 'discovery', mood: 'adventure'},
                    { title: "Bar Cach√© Speakeasy", loc: "Pigalle", icon: "üç∏", type: 'discovery', mood: 'adventure'},
                    { title: "Th√©√¢tre Immersif", loc: "Manoir", icon: "üé≠", type: 'discovery', mood: 'adventure' },
                    { title: "Lancer de Hache", loc: "Canal", icon: "ü™ì", type: 'discovery', mood: 'adventure' },
                    { title: "Simulateur Chute Libre", loc: "Villette", icon: "ü™Ç", type: 'discovery', mood: 'adventure' },
                    { title: "Visite √âgouts", loc: "Pont de l'Alma", icon: "üöá", type: 'discovery', mood: 'adventure' },
                    { title: "Urbex Guid√©", loc: "Banlieue", icon: "üèöÔ∏è", type: 'discovery', mood: 'adventure' },
                    { title: "Stand-Up Comedy", loc: "Republique", icon: "üé§", type: 'discovery', mood: 'adventure' }
                ],

                // IMAGES VILLES (FULL LIST)
                cityImages: {
                    'Paris': 'https://images.unsplash.com/photo-1550340499-a6c60fc8287c?q=80&w=800',
                    'Marseille': 'https://images.unsplash.com/photo-1566838217578-1903568a76d9?w=800',
                    'Lyon': 'https://images.unsplash.com/photo-1602087594298-706ccc894bfd?w=800',
                    'Toulouse': 'https://images.unsplash.com/photo-1650707199496-b02442055332?w=800',
                    'Nice': 'https://images.unsplash.com/photo-1601226372175-41ff0f30bd9c?w=800',
                    'Nantes': 'https://images.unsplash.com/photo-1676283898167-addc4238bee8?w=800',
                    'Montpellier': 'https://images.unsplash.com/photo-1634131348313-bacc2b12d328?w=800',
                    'Strasbourg': 'https://images.unsplash.com/photo-1596036978267-c56635f573c9?w=800',
                    'Bordeaux': 'https://images.unsplash.com/photo-1698608216843-67ae1151b2b8?w=800',
                    'Lille': 'https://images.unsplash.com/photo-1723366646754-17722fefdf80?w=800'
                },

                // LISTES STATIQUES
                cities: ['Paris', 'Marseille', 'Lyon', 'Toulouse', 'Nice', 'Nantes', 'Montpellier', 'Strasbourg', 'Bordeaux', 'Lille'],
                navItems: [
                    {id: 'home', label: 'Accueil', icon: '<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>'},
                    {id: 'explore', label: 'Explorer', icon: '<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>'},
                    {id: 'favorites', label: 'Favoris', icon: '<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>'},
                    {id: 'create', label: 'Cr√©er', icon: '<svg class="w-5 h-5 text-wander-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>'},
                    {id: 'box', label: 'Mes Box', icon: '<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>'},
                    {id: 'subscription', label: 'Abonn.', icon: '<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>'},
                    {id: 'account', label: 'Compte', icon: '<svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>'}
                ],
                
                popularSearches: ["C√©ramique", "Th√©√¢tre", "Solo Date", "Rencontre", "Concert", "Impro", "DIY", "Mus√©e", "Duo", "Vin & Paint"],
                 categories: [
                    { name: 'Modelage', image: 'https://images.unsplash.com/photo-1493106641515-6b5631de4bb9?w=400&q=60' },
                    { name: 'Bougies', image: 'https://images.unsplash.com/photo-1735380674308-9e278d784e8f?w=400&q=60' },
                    { name: 'C√©ramique', image: 'https://images.unsplash.com/photo-1610701596007-11502861dcfa?w=400&q=60' },
                    { name: 'Peinture', image: 'https://images.unsplash.com/photo-1513364776144-60967b0f800f?w=400&q=60' },
                    { name: 'Tufting', image: 'https://images.unsplash.com/photo-1736865875785-2073deb7185c?w=400&q=60' },
                    { name: 'Parfumerie', image: 'https://images.unsplash.com/photo-1615634260167-c8cdede054de?w=400&q=60' },
                    { name: 'Th√©√¢tre', image: 'https://images.unsplash.com/photo-1576724196706-3f23f51ea351?w=400&q=60' },
                    { name: 'Stand-up', image: 'https://images.unsplash.com/photo-1512117789060-5de1ecef9eb7?w=400&q=60' },
                    { name: 'Insolite', image: 'https://images.unsplash.com/photo-1511632765486-a01980e01a18?w=400&q=60' },
                    { name: 'Concert', image: 'https://images.unsplash.com/photo-1501612780327-45045538702b?w=400&q=60' },
                ],
                exploreCategories: [
                     { name: "Art & Manuel", image: "https://images.unsplash.com/photo-1452860606245-08befc0ff44b?w=400&q=60" },
                     { name: "Spectacles", image: "https://images.unsplash.com/photo-1576724196706-3f23f51ea351?w=400&q=60" },
                     { name: "Expos & Mus√©es", image: "https://images.unsplash.com/photo-1566127444979-b3d2b654e3d7?w=400&q=60" },
                     { name: "Insolite", image: "https://images.unsplash.com/photo-1557160854-e1e89fdd3286?w=400&q=60" },
                     { name: "Sorties Groupe", image: "https://images.unsplash.com/photo-1511632765486-a01980e01a18?w=400&q=60" },
                     { name: "Bien-√™tre", image: "https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=400&q=60" },
                     { name: "Gastronomie", image: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400&q=60" },
                     { name: "Plein Air", image: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=400&q=60" }
                ],
                partnerBoxes: [
                      { id: 1, title: 'Escale au Louvre', partner: 'Mus√©e du Louvre', type: 'Culture', price: '45‚Ç¨', image: 'https://images.unsplash.com/photo-1609086460188-f33e3dd4de2a?w=400&q=60', liked: false },
                      { id: 2, title: 'Myst√®res du Panth√©on', partner: 'Centre des Monuments', type: 'Histoire', price: '40‚Ç¨', image: 'https://images.unsplash.com/photo-1743107924367-50a73310950a?w=400&q=60', liked: false },
                      { id: 3, title: 'Op√©ra & Coulisses', partner: 'Op√©ra Garnier', type: 'Musique', price: '50‚Ç¨', image: 'https://images.unsplash.com/photo-1645956734722-ac84c86fa4da?w=400&q=60', liked: false },
                      { id: 4, title: 'Versailles Intime', partner: 'Ch√¢teau de Versailles', type: 'Royal', price: '55‚Ç¨', image: 'https://images.unsplash.com/photo-1591828353335-197466da2a4e?w=400&q=60', liked: false }
                ],
                oneShotBoxes: [
                    { id: 1, title: 'Saint-Valentin', subtitle: 'D√Æner aux chandelles', price: '95‚Ç¨', rating: 4.9, reviews: 120, liked: false, endDate: new Date(Date.now() + 250000000), timerDisplay: '', image: 'https://images.unsplash.com/photo-1518199266791-5375a83190b7?w=400&q=60' },
                    { id: 2, title: 'P√¢ques Gourmand', subtitle: 'Chasse aux ≈ìufs', price: '55‚Ç¨', rating: 4.7, reviews: 85, liked: false, endDate: new Date(Date.now() + 500000000), timerDisplay: '', image: 'https://images.unsplash.com/photo-1548741487-18d363dc4469?w=400&q=60' },
                    { id: 3, title: 'Nouvel An', subtitle: 'Soir√©e Masqu√©e', price: '120‚Ç¨', rating: 5.0, reviews: 210, liked: false, endDate: new Date(Date.now() + 800000000), timerDisplay: '', image: 'https://images.unsplash.com/photo-1499233983070-99a5f004e720?w=400&q=60' },
                    { id: 4, title: 'Rentr√©e Arty', subtitle: 'Atelier Peinture', price: '45‚Ç¨', rating: 4.8, reviews: 342, liked: false, endDate: new Date(Date.now() + 150000000), timerDisplay: '', image: 'https://images.unsplash.com/photo-1757085242652-f8cd4d3de889?w=400&q=60' },
                    { id: 5, title: 'Summer Vibes', subtitle: 'Cin√©ma plein air', price: '60‚Ç¨', rating: 4.9, reviews: 56, liked: false, endDate: new Date(Date.now() + 350000000), timerDisplay: '', image: 'https://images.unsplash.com/photo-1658195952756-892740657893?w=400&q=60' },
                    { id: 6, title: 'Halloween', subtitle: 'Manoir Hant√©', price: '50‚Ç¨', rating: 4.6, reviews: 98, liked: false, endDate: new Date(Date.now() + 600000000), timerDisplay: '', image: 'https://images.unsplash.com/photo-1477516561410-f0b5dd8319e4?w=400&q=60' },
                    { id: 7, title: 'F√™te des M√®res', subtitle: 'Atelier Floral', price: '85‚Ç¨', rating: 5.0, reviews: 150, liked: false, endDate: new Date(Date.now() + 420000000), timerDisplay: '', image: 'https://images.unsplash.com/photo-1544928147-9e66f653d177?w=400&q=60' },
                    { id: 8, title: 'No√´l Magique', subtitle: 'March√© Priv√©', price: '70‚Ç¨', rating: 4.9, reviews: 300, liked: false, endDate: new Date(Date.now() + 900000000), timerDisplay: '', image: 'https://images.unsplash.com/photo-1544212415-b269f18bf7ed?w=400&q=60' },
                ],
                top10: [
                    { id: 1, title: 'Nuit au Mus√©e', subtitle: 'Visite aux flambeaux', liked: false, price: '30‚Ç¨', rating: 4.8, image: 'https://images.unsplash.com/photo-1566127444979-b3d2b654e3d7?w=400&q=60' },
                    { id: 2, title: 'Vins & Toiles', subtitle: 'D√©gustation & Peinture', liked: false, price: '45‚Ç¨', rating: 4.9, image: 'https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=400&q=60' },
                    { id: 3, title: 'Poterie Date', subtitle: 'Romance & Argile', liked: false, price: '50‚Ç¨', rating: 4.7, image: 'https://images.unsplash.com/photo-1610701596007-11502861dcfa?w=400&q=60' },
                    { id: 4, title: 'Paris Secret', subtitle: 'Catacombes', liked: false, price: '25‚Ç¨', rating: 4.5, image: 'https://images.unsplash.com/photo-1734461257073-58971b921cb3?w=400&q=60' },
                    { id: 5, title: 'Op√©ra Rock', subtitle: 'Coulisses cach√©es', liked: false, price: '20‚Ç¨', rating: 4.8, image: 'https://images.unsplash.com/photo-1645956734722-ac84c86fa4da?w=400&q=60' },
                    { id: 6, title: 'Jardin Zen', subtitle: 'M√©ditation guid√©e', liked: false, price: '15‚Ç¨', rating: 4.9, image: 'https://images.unsplash.com/photo-1558869632-279458ac1734?w=400&q=60' },
                    { id: 7, title: 'Street Vibes', subtitle: 'Graffiti Tour', liked: false, price: 'Gratuit', rating: 4.6, image: 'https://images.unsplash.com/photo-1659609237289-93e13c4a3a05?w=400&q=60' },
                    { id: 8, title: 'Gastro Chef', subtitle: 'Cours √©toil√©', liked: false, price: '120‚Ç¨', rating: 5.0, image: 'https://images.unsplash.com/photo-1545659531-9a66f06e260a?w=400&q=60' },
                    { id: 9, title: 'Jazz & Seine', subtitle: 'Concert sur l\'eau', liked: false, price: '35‚Ç¨', rating: 4.7, image: 'https://images.unsplash.com/photo-1501612780327-45045538702b?w=400&q=60' },
                    { id: 10, title: 'Photo Walk', subtitle: 'Paris argentique', liked: false, price: '10‚Ç¨', rating: 4.8, image: 'https://images.unsplash.com/photo-1552168324-d612d77725e3?w=400&q=60' },
                ],
                
                subscriptionTimeline: [
                    { name: 'D√©cembre', status: 'past', theme: 'F√©√©rie', icon: '‚ú®', desc: 'Box termin√©e' },
                    { name: 'Janvier', status: 'active', theme: 'Endless Summer', icon: 'üåä', desc: 'Box livr√©e - En cours' },
                    { name: 'F√©vrier', status: 'locked', theme: 'Romantisme Noir', icon: 'ü•Ä', desc: 'Arrive bient√¥t' },
                    { name: 'Mars', status: 'locked', theme: 'Th√®me Surprise', icon: '‚ùì', desc: 'Myst√®re total' },
                    { name: 'Avril', status: 'locked', theme: 'Japonisme & Estampes', icon: 'üåä', desc: 'Inspiration Asie' },
                    { name: 'Mai', status: 'locked', theme: 'Street Art & Graffiti', icon: 'üß±', desc: 'Art urbain' },
                ],
                
                config: { mood: '', company: '', type: '', themes: [] },

                // --- FUNCTIONS ---
                init() {
                     this.$nextTick(() => { 
                         // CONFIG SWIPER
                         new Swiper('.categories-swiper', { slidesPerView: 'auto', spaceBetween: 16, freeMode: true, mousewheel: true, grabCursor: true });
                         new Swiper('.seasonal-swiper', { slidesPerView: 'auto', spaceBetween: 16, freeMode: true, mousewheel: true, grabCursor: true });
                         new Swiper('.top10-swiper', { slidesPerView: 'auto', spaceBetween: 16, freeMode: true, mousewheel: true, grabCursor: true });
                     });
                },
                initTimers() {
                    setInterval(() => {
                        const now = new Date().getTime();
                        this.oneShotBoxes.forEach(box => {
                            if (!box.endDate) return;

                            const distance = box.endDate.getTime() - now;
                            if (distance < 0) { box.timerDisplay = "Termin√©"; } else {
                                const d = Math.floor(distance / (1000 * 60 * 60 * 24));
                                const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                                const s = Math.floor((distance % (1000 * 60)) / 1000);
                                box.timerDisplay = `${d}j ${h}h ${m}m ${s}s`;
                            }
                        });
                    }, 1000);
                },
                
                // FONCTION FAVORIS CORRIG√âE (CLE UNIQUE)
                getFavorites() {
                    // Les UIDs emp√™chent les doublons techniques
                    const oneshots = this.oneShotBoxes.filter(i => i.liked).map(i => ({...i, uid: 'os-' + i.id}));
                    const tops = this.top10.filter(i => i.liked).map(i => ({...i, uid: 'top-' + i.id}));
                    const partners = this.partnerBoxes.filter(i => i.liked).map(i => ({...i, uid: 'part-' + i.id}));
                    
                    // Fusion sans doublons visuels
                    return [...oneshots, ...tops, ...partners];
                },
                
                toggleLike(item) { 
                    // Mise √† jour de l'√©tat "liked" sur l'objet original
                    // On doit retrouver l'objet dans sa liste d'origine
                    let targetList = this.oneShotBoxes;
                    if(item.uid && item.uid.startsWith('top')) targetList = this.top10;
                    if(item.uid && item.uid.startsWith('part')) targetList = this.partnerBoxes;
                    
                    const realItem = targetList.find(i => i.id === item.id);
                    if(realItem) {
                        realItem.liked = !realItem.liked;
                        // Forcer le rafra√Æchissement
                        this.refreshKey++; 
                    } else {
                        // Cas fallback (ex: clic direct hors liste favoris)
                        item.liked = !item.liked;
                        this.refreshKey++;
                    }
                },
                openQr(ticket) { this.activeTicket = ticket; this.currentQrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${ticket.id}`; this.qrOpen = true; },
                closeQr() { this.qrOpen = false; },
                
                setPath(p) { this.selectedPath = p; },
                toggleTheme(t) { 
                    if(this.config.themes.includes(t)) this.config.themes = this.config.themes.filter(x => x !== t); 
                    else this.config.themes.push(t); 
                },
                
                nextStep() { this.step++; }, 

                shiftTicket(ticket) {
                    const months = { 'JAN': 0, 'F√âV': 1, 'MAR': 2, 'AVR': 3, 'MAI': 4, 'JUIN': 5, 'JUIL': 6, 'AO√õT': 7, 'SEPT': 8, 'OCT': 9, 'NOV': 10, 'D√âC': 11 };
                    const revMonths = Object.keys(months);
                    
                    let currentMonthIndex = months[ticket.month] || 0;
                    let currentDay = parseInt(ticket.day);
                    let date = new Date(2026, currentMonthIndex, currentDay);
                    
                    date.setDate(date.getDate() + 7);
                    
                    ticket.day = date.getDate().toString();
                    ticket.month = revMonths[date.getMonth()];
                    
                    alert(`‚úÖ Billet report√© au ${ticket.day} ${ticket.month} !`);
                },

                transferTicket(ticket) {
                    if(this.transfersLeft > 0) {
                        ticket.transferred = true;
                        this.transfersLeft--;
                        alert(`‚úÖ Billet transf√©r√©.\nTransferts restants cette ann√©e : ${this.transfersLeft}`);
                    } else {
                        alert("‚ùå Limite de transferts atteinte.");
                    }
                },

                startGeneration() { 
                    this.step = 6; 
                    setTimeout(() => { 
                        let generatedTickets = [];
                        
                        // LOGIQUE 2+2 ou ALEATOIRE
                        if (this.selectedPath === 'random') {
                             // Random 4 items
                             generatedTickets = this.allActivities.sort(() => 0.5 - Math.random()).slice(0, 4);
                        } else {
                            // 2 Confort + 2 D√©couverte (Li√©s au mood)
                            const comforts = this.allActivities.filter(a => a.type === 'comfort' && a.mood === this.selectedPath);
                            const discoveries = this.allActivities.filter(a => a.type === 'discovery' && a.mood === this.selectedPath);
                            
                            // Fallback si pas assez d'activit√©s sp√©cifiques
                            const extraComforts = this.allActivities.filter(a => a.type === 'comfort');
                            const extraDiscoveries = this.allActivities.filter(a => a.type === 'discovery');

                            generatedTickets = [
                                ...(comforts.length >= 2 ? comforts : extraComforts).sort(() => 0.5 - Math.random()).slice(0, 2),
                                ...(discoveries.length >= 2 ? discoveries : extraDiscoveries).sort(() => 0.5 - Math.random()).slice(0, 2)
                            ];
                        }
                        
                        // Calcul du texte "Valable pour X personnes"
                        let peopleCount = 1;
                        let peopleText = "Billet valable 1 personne";
                        
                        if (this.config.company === 'duo') { peopleCount = 2; peopleText = "Billet valable 2 personnes"; }
                        else if (this.config.company === 'tribu') { peopleCount = 4; peopleText = "Billet valable 4 personnes"; }
                        else if (this.config.company === 'groupe') { peopleText = "Session Collective (1 pers)"; }

                        // On injecte ce texte dans les tickets
                        generatedTickets = generatedTickets.map(t => ({...t, peopleText: peopleText}));

                        // CALCUL DE LA DATE DE VALIDIT√â (1 AN)
                        const today = new Date();
                        const validityDate = new Date(today.setFullYear(today.getFullYear() + 1));
                        const dateString = validityDate.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short', year: 'numeric' });

                        const title = `Box ${this.config.mood || 'Myst√®re'} ‚Ä¢ ${this.config.themes[0] || 'Surprise'}`;

                        this.previewBox = {
                            title: title,
                            desc: "Une s√©lection 100% personnalis√©e selon vos go√ªts.",
                            tickets: generatedTickets,
                            validUntil: dateString
                        };

                        this.step = 7; 
                    }, 2500); 
                },
                
                buyBox() {
                    // Cr√©ation d'une nouvelle box inactive pour l'accord√©on
                    this.purchasedBoxes.push({
                        id: Date.now(),
                        title: this.previewBox.title,
                        subtitle: this.previewBox.desc,
                        status: 'inactive',
                        tickets: [...this.previewBox.tickets],
                        validUntil: this.previewBox.validUntil,
                        expanded: false // Pour l'accord√©on
                    });
                    
                    // AJOUT AUX FAVORIS SI LIK√â (CORRECTION V36)
                    if(this.previewBoxLiked) {
                        this.oneShotBoxes.unshift({
                            id: Date.now() + 1, // ID unique pour √©viter conflit
                            title: this.previewBox.title,
                            subtitle: this.previewBox.desc,
                            price: "Achet√©",
                            rating: 5.0,
                            liked: true,
                            image: 'https://images.unsplash.com/photo-1513530534585-c7b1394c6d51?w=400&q=60',
                            timerDisplay: '' // Propri√©t√© vide pour √©viter erreur JS
                        });
                        this.refreshKey++; // Force refresh liste favoris
                    }
                    
                    this.resetConfig(); // Reset propre pour revenir √©tape 1
                    this.tab = 'box'; 
                },
                
                resetConfig() {
                    this.step = 1;
                    this.config = { mood: '', company: '', type: '', themes: [] };
                    this.previewBox = {};
                    this.previewBoxLiked = false;
                }
            }))
        })
    </script>
</body>
</html>